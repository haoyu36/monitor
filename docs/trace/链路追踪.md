> 链路追踪为分布式应用的开发者提供了完整的调用链路还原、调用请求量统计、链路拓扑、应用依赖分析等工具，可以帮助开发者快速分析和诊断分布式应用架构下的性能瓶颈，提高微服务时代下的开发诊断效率


# 一：链路追踪

使用微服务架构程序时，服务之间的调用可能会出现延迟问题，所以需要对其进行监控。分布式追踪系统核心有三个：代码埋点，数据存储和查询展现

## 1.1 链路追踪解决什么问题

- 性能调优，记录客户端一次请求的全过程，调用的服务及经历的时长
- 提前洞察数据库的问题
- 定位网络问题

## 1.2 概念

- Trace：一次分布式调用链
- Span：调用链中被命名并计时的连续性执行片段
- Annotation：附着在Span上的日志信息
- Sampling：采样率

## 调用链

一个调用链代表一个事务或者流程在（分布式）系统中的执行过程。调用链是多个 Span 组成的一个有向无环图（Directed Acyclic Graph，简称 DAG），Span 之间的关系被命名为 References

每一个 Span 代表调用链中被命名并计时的连续性执行片段

## Span

每个 Span 包含以下对象：

- Operation name：操作名称 （也可以称作 Span name）
- Start timestamp：起始时间
- Finish timestamp：结束时间
- Span tag：一组键值对构成的 Span 标签集合。键值对中，键必须为 String，值可以是字符串、布尔或者数字类型
- Span log：一组 Span 的日志集合。每次 Log 操作包含一个键值对和一个时间戳。键值对中，键必须为 String，值可以是任意类型
- SpanContext: pan 上下文对象。每个 SpanContext 包含以下状态：
    - 要实现任何一个 OpenTracing，都需要依赖一个独特的 Span 去跨进程边界传输当前调用链的状态（例如：Trace 和 Span 的 ID）
    - Baggage Items 是 Trace 的随行数据，是一个键值对集合，存在于 Trace 中，也需要跨进程边界传输
- References（Span 间关系）：相关的零个或者多个 Span（Span 间通过 SpanContext 建立这种关系）



# 扩展阅读

- [OpenTracing官网](https://opentracing.io/)
- [opentracing文档中文版 ( 翻译 ) 吴晟](https://wu-sheng.gitbooks.io/opentracing-io/content/)
- [Dapper，大规模分布式系统的跟踪系统](https://github.com/bigbully/Dapper-translation)


- [Monitoring and Observability](https://medium.com/@copyconstruct/monitoring-and-observability-8417d1952e1c)
- [Health Checks and Graceful Degradation in Distributed Systems](https://medium.com/@copyconstruct/health-checks-in-distributed-systems-aa8a0e8c1672)
- [蚂蚁金服在云原生架构下的可观察性的探索和实践 | Meetup#3 回顾](https://zhuanlan.zhihu.com/p/79269461)
- [SOFA Meetup#3 广州站-从开源技术到产品能力](https://tech.antfin.com/community/activities/779/review/900)


